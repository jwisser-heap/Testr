<html>
  <head>
    <title>Testr</title>
    <link href="main.css" rel="stylesheet" />

    <!-- BEGIN CSP -->
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' https://sdk.us.heap-api.com https://cdn.us.heap-api.com https://heapanalytics.com https://*.heapanalytics.com *.cloudfront.net https://*.contentsquare.net app.contentsquare.com https://*.hotjar.com 'unsafe-inline' 'unsafe-eval'; img-src https://heapanalytics.com https://*.hotjar.com https://*.contentsquare.net; style-src 'self' https://heapanalytics.com https://*.hotjar.com 'unsafe-inline'; connect-src https://c.us.heap-api.com https://heapanalytics.com https://*.auryc.com https://*.hotjar.com https://*.hotjar.io wss://*.hotjar.com https://*.contentsquare.net; font-src  https://heapanalytics.com https://*.hotjar.com; child-src https://*.contentsquare.net blob:; worker-src blob:;"
    />
    <!-- END CSP -->

    <!-- BEGIN HEAP JS 5 TAG -->
    <script type="text/javascript">
      (window.heapReadyCb = window.heapReadyCb || []),
        (window.heap = window.heap || []),
        (heap.load = function (e, t) {
          (window.heap.envId = e),
            (window.heap.clientConfig = t = t || {}),
            (window.heap.clientConfig.shouldFetchServerConfig = !1);
          var a = document.createElement("script");
          (a.type = "text/javascript"),
            (a.async = !0),
            (a.src =
              "https://cdn.us.heap-api.com/config/" + e + "/heap_config.js");
          var r = document.getElementsByTagName("script")[0];
          r.parentNode.insertBefore(a, r);
          var n = [
              "init",
              "startTracking",
              "stopTracking",
              "track",
              "resetIdentity",
              "identify",
              "identifyHashed",
              "getSessionId",
              "getUserId",
              "getIdentity",
              "addUserProperties",
              "addEventProperties",
              "removeEventProperty",
              "clearEventProperties",
              "addAccountProperties",
              "addAdapter",
              "addTransformer",
              "addTransformerFn",
              "onReady",
              "addPageviewProperties",
              "removePageviewProperty",
              "clearPageviewProperties",
              "trackPageview",
            ],
            i = function (e) {
              return function () {
                var t = Array.prototype.slice.call(arguments, 0);
                window.heapReadyCb.push({
                  name: e,
                  fn: function () {
                    heap[e] && heap[e].apply(heap, t);
                  },
                });
              };
            };
          for (var p = 0; p < n.length; p++) heap[n[p]] = i(n[p]);
        });
      heap.load("368830506");

      // Create adapter to watch for title update
      var adapterName = "waitForTitleUpdateAdapter";

      // Helper that resolves when the title is updated
      function watchForTitleChange() {
        return new Promise(function (resolve) {
          // Observe DOM changes until title is updated

          var target = document.querySelector("title");

          // create an observer instance
          var observer = new MutationObserver(function (mutations) {
            observer.disconnect();
            resolve;
          });

          // configuration of the observer:
          var config = { subtree: true, characterData: true, childList: true };

          // pass in the target node, as well as the observer options
          observer.observe(target, config);
        });
      }

      var adapterFn = function () {
        return watchForTitleChange().then(function () {
          heap.markAdapterAsResolved(adapterName);
        });
      };

      // Defaults to 5 seconds of blocking
      var adapter = {
        name: adapterName,
        fn: adapterFn,
      };

      var config = {
        isBlocking: true,
        blockDurationInMs: 5000,
      };

      heap.addAdapter(adapter, config);

      // It would be nice if we could do this next part with one transformer,
      // but we want to modify both pageview and interaction messages so we need
      // two transformers.
      // https://www.youtube.com/shorts/f0huI_wZ6UE

      // Create transformer to update pageview title property with current title value
      var pageviewTransformerName = "updatePageviewTitlePropertyTransformer";
      var pageviewTransformerFn = function (messages) {
        var updatePageviewTitleProperty = function (message) {
          try {
            // Check if message is a pageview before updating
            if (message.type === "meta_pageview") {
              message.data.pageview_info.title = document.title;
            }

            return message;
          } catch (e) {
            return message;
          }
        };

        return messages.map(updatePageviewTitleProperty);
      };

      // Create transformer to update pageview title property with current title value
      var interactionTransformerName =
        "updateInteractionTitlePropertyTransformer";
      var interactionTransformerFn = function (messages) {
        var updateInteractionTitleProperty = function (message) {
          try {
            // Check if message is an interaction before updating
            if (message.data.event.interaction) {
              message.data.pageview_info.title = document.title;
            }

            return message;
          } catch (e) {
            return message;
          }
        };

        return messages.map(updateInteractionTitleProperty);
      };

      // We could leave the pipeline off the interaction transformer since 'general'
      // is the default, but it rarely hurts to be explicit.
      heap.addTransformerFn(
        pageviewTransformerName,
        pageviewTransformerFn,
        "metadata"
      );
      heap.addTransformerFn(
        interactionTransformerName,
        interactionTransformerFn,
        "general"
      );
    </script>
    <!-- END HEAP JS 5 TAG -->
  </head>
  <body data-testid="network-card-4" id="mainBody">
    <header class="pageHeader">
      <h1 id="pageTitle">Testr</h1>
    </header>
    <!-- A comment. -->
    <h1 id="lessChild" name="Test Heading" title="Test Heading">
      Test Heading
    </h1>
    <form id="mainPageForm">
      <input
        class="blockInput slider"
        id="topSlider"
        type="range"
        min="0"
        max="100"
      />
      <input
        class="blockInput textField"
        id="topTextField"
        type="text"
        placeholder="SomePlaceholder"
      />
      <select class="blockInput dropdown" id="topDropdown">
        <option value="">-- Please select a value --</option>
        <option value="Value 1">Value 1</option>
        <option value="Value 2">Value 2</option>
        <option value="Value 3">Value 3</option>
        <option value="Value 4">Value 4</option>
        <option value="Value 5">Value 5</option>
      </select>
      <input
        class="blockInput"
        id="triggerSnapshotButton"
        type="submit"
        value="Trigger Snapshot"
      />
    </form>
    <main class="mainArticleHolder">
      <article
        id="mainArticle"
        name="[N] Reasons to Build Your Own Testr Page"
        title="[T] Reasons to Build Your Own Testr Page"
      >
        <h2
          id="mainArticleTitle"
          data-heap-track="mainArticleTitle someOtherValue"
          data-test-tab="test-tab"
        >
          Reasons To Build Your Own Testr Page
        </h2>

        <ol
          id="reasonsForTestrPage"
          data-heap-track="reasonsForTestrPage"
          data-test-tab="some-value"
        >
          <li class="reasonsListItem">
            You can test setting up a
            <a
              href="https://jwisser-heap.github.io/Testr/heap-dude.crx"
              download
              class="visibleLink"
              >direct heap-dude download</a
            >. Sadly, it doesn't currently work.
          </li>
          <li class="reasonsListItem">Reason 2</li>
          <li class="reasonsListItem">Reason 3</li>
          <li class="reasonsListItem">Reason 4</li>
        </ol>

        <p class="mainArticleText" data-test-tab="some-basic-text">
          This is just some basic text. Click through to the other page
          <a href="otherpage.html" class="visibleLink">here.</a>
        </p>

        <p class="mainArticleText" data-test-tab="some-more-basic-text">
          This is some more basic text. Click through to
          <a href="https://alackofcharacter.com" class="visibleLink"
            >A Lack of Character.</a
          >
        </p>
      </article>
      <div class="heap required" data-cert-requirement="true">
        <span
          class="omg-a-totally-new-class"
          id="not-like-other-divs"
          data-new-attribute-1="true"
          data-new-attribute-2="false"
          >This is some text with a
          <a href="https://heap.io" class="visibleLink">link to Heap</a>.</span
        >
      </div>
    </main>

    <div class="sidebar"></div>
    <footer class="pageFooter">
      <p id="copyrightDisclaimer">
        <span class="htmlEntitySymbol">&COPY;</span>
        <span id="copyrightNotice">2021 Jonas Wisser.</span> Don't be a jerk.
      </p>
      <address>
        <ul id="addressItems">
          <li class="singularAddressItem">
            <a href="mailto:jonas.wisser@heap.io">jonas.wisser@heap.io</a>
          </li>
          <li class="singularAddressItem">
            <a href="tel:+15555555555">(555) 555-5555</a>
          </li>
        </ul>
      </address>
    </footer>
  </body>
</html>
